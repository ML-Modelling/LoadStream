<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Load Balancing Simulation</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.4.1/socket.io.js"></script>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; background-color: #121212; color: white; }
        canvas { background-color: #1E1E1E; border-radius: 10px; padding: 10px; margin: 20px auto; }
        .btn { padding: 10px 20px; margin: 10px; background-color: #28a745; color: white; border: none; border-radius: 5px; cursor: pointer; }
        .btn:disabled { background-color: #555; }
        #gifContainer img { width: 50%; margin-top: 20px; border-radius: 10px; }
    </style>
</head>
<body>

    <h1>Smart Load Balancing Simulation</h1>
    <label for="num_requests">Number of Requests:</label>
    <input type="number" id="num_requests" value="50" min="1">

    <button class="btn" onclick="startSimulation()">Run Simulation</button>
    <button class="btn" id="downloadBtn" onclick="downloadGif()" disabled>Download GIF</button>

    <canvas id="loadChart"></canvas>

    <div id="gifContainer"></div>

    <script>
        let socket = io();
        let ctx = document.getElementById('loadChart').getContext('2d');
        let loadChart = new Chart(ctx, {
            type: 'line',
            data: { labels: [], datasets: [
                    { label: 'Demand', borderColor: 'cyan', data: [] },
                    { label: 'Storage', borderColor: 'magenta', data: [] },
                    { label: 'Rewards', borderColor: 'yellow', data: [] }
                ] },
            options: {
                responsive: true,
                animation: { duration: 500 },
                scales: { x: { display: true, title: { display: true, text: 'Time Step', color: 'white' } },
                          y: { display: true, title: { display: true, text: 'Value', color: 'white' } } }
            }
        });

        function startSimulation() {
            let numRequests = document.getElementById('num_requests').value;
            socket.emit('run_simulation', { num_requests: numRequests });
        }

        socket.on('update_chart', function(data) {
            loadChart.data.labels.push(data.time);
            loadChart.data.datasets[0].data.push(data.demand);
            loadChart.data.datasets[1].data.push(data.storage);
            loadChart.data.datasets[2].data.push(data.rewards);
            loadChart.update();
        });

        socket.on('simulation_complete', function(data) {
            document.getElementById('gifContainer').innerHTML = `<img src="${data.gif_url}" alt="Simulation GIF">`;
            document.getElementById('downloadBtn').disabled = false;
        });

        function downloadGif() {
            window.location.href = "/download_gif";
        }
    </script>

</body>
</html>
